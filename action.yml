name: "Gemini via GitHub Actions"
description: "A tool to allow Gemini to interact with GitHub issues and pull requests."

author: "strawgate"

inputs:
  gemini_api_key:
    description: "The Gemini AI API key."
    required: true
  github_token:
    description: "The GitHub token for authentication."
    required: true
  github_repository:
    description: "The GitHub repository owner/name."
    required: true
    default: "${{ github.repository }}"
  github_repo_id:
    description: "The GitHub repository ID."
    required: true
    default: "${{ github.event.repository.id }}"
  github_issue_number:
    description: "The GitHub issue number (optional)."
    required: false
  github_pr_number:
    description: "The GitHub pull request number (optional)."
    required: false
    default: "${{ github.event.pull_request.number }}"
  model:
    description: "The Gemini model to use."
    required: false
    default: "gemini-2.5-flash-preview-04-17"
  activation_restrictions:
    description: "Comma-separated activation restrictions (optional)."
    required: false
  config_file:
    description: "Path to the config file (optional)."
    required: false
  tool_restrictions:
    description: "Comma-separated list of tool restrictions (optional)."
    required: false
  command_restrictions:
    description: "Comma-separated list of command restrictions (optional)."
    required: false
  debug:
    description: "Enable debug mode (optional)."
    required: false
    default: "false"
    type: boolean
  user_question:
    description: "The user's natural language question."
    required: true

branding:
  icon: "code"
  color: "blue"

runs:
  using: "composite"
  steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        ref: main
        fetch-depth: 0

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'

    - name: Install Poetry
      shell: bash
      run: |
        curl -sSL https://install.python-poetry.org | python3 -

    - name: Install dependencies
      shell: bash
      run: |
        poetry install

    - name: Run Gemini Action
      shell: bash
      run: |
        poetry run python -m src.gemini_for_github.main 
      env:
        github-token: ${{ inputs.GITHUB_TOKEN }}
        gemini-api-key: ${{ inputs.GEMINI_API_KEY }}
        github-pr-number: ${{ github.event.pull_request.number }}
        github-issue-number: ${{ github.event.issue.number }}
        tool-restrictions: ${{ inputs.tool_restrictions }}
        command-restrictions: ${{ inputs.command_restrictions }}
        activation-restrictions: ${{ inputs.activation_restrictions }}
        config-file: ${{ inputs.config_file }}
        model: ${{ inputs.model }}
        debug: ${{ inputs.debug }}
        user-question: ${{ inputs.user_question }}